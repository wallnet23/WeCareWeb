<form [formGroup]="stepClusterForm">
  <div class=" mt-3">
    <mat-card style="border-bottom: 2px solid lightgray;" class="container-fluid">
      <mat-card-header class="titleBorder">
        <mat-card-title style="font-weight: bold;">Battery Info</mat-card-title>
      </mat-card-header>
      <mat-card-content class="row">
        <div class="col-12 col-md-6 p-0">
          <label class="mt-3 fw-bold" for="refidwecaresystemvolt" style=" font-size: medium;">
            High or low voltage</label>
          <select class="form-select" formControlName="refidwecaresystemvolt" id="refidwecaresystemvolt">
            <option [ngValue]="null">Select a value</option>
            <option *ngFor="let volt of systemVolt" [ngValue]="volt.id">{{language_now == 'it' ? volt.name_it :
              volt.name_en}}</option>
          </select>
        </div>
        <!-- <div class="col-12 col-md-6 p-0" *ngIf="stepClusterForm.get('refidwecaresystemvolt')?.value != null"> -->
        <div class="col-12 col-md-6 p-0">
          <label class="mt-3" for="system_model" style="font-weight: bold; font-size: medium;">System
            Model</label>
          <select class="form-select" formControlName="system_model">
            <option [ngValue]="null" id="system_model">Select a model</option>
            <option *ngFor="let model of systemModel_view" [ngValue]="model.id">
              {{language_now == 'it' ? model.name_it : model.name_en}}
            </option>
          </select>
        </div>

        <!-- <div class="col-12 col-md-6 p-0" *ngIf="stepClusterForm.get('system_model')?.value != null"> -->
        <div class="col-12 col-md-6 p-0">
          <label class="mt-3" for="refidwecaresystemtype" style="font-weight: bold; font-size: medium;">Battery
            Type</label>
          <select class="form-select" formControlName="refidwecaresystemtype" id="refidwecaresystemtype">
            <option [ngValue]="null">Select a type</option>
            <option *ngFor="let type of systemType_view" [ngValue]="type.id">
              {{language_now == 'it' ? type.name_it : type.name_en}}
            </option>
          </select>
        </div>


        <!-- <div *ngIf="stepClusterForm.get('refidwecaresystemtype')?.value != null" class="col-12 p-0"> -->
        <div *ngIf="stepClusterForm.get('refidwecaresystemtype')?.value != null" class="col-12 p-0">
          <label class="form-check-label mt-3 mr-2" for="singleBattery">
            Single Battery</label>
          <div class="form-check form-check-inline">
            <input class="form-check-input mt-1" type="radio" [value]="1" formControlName="cluster_singlebattery">
            <label class="form-check-label" for="yes">Yes</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input mt-1" type="radio" [value]="0" formControlName="cluster_singlebattery">
            <label class="form-check-label" for="no">No</label>
          </div>
        </div>
        <!-- <div *ngIf="stepClusterForm.get('cluster_singlebattery')?.value == 0" class="col-12 p-0"> -->
        <div *ngIf="stepClusterForm.get('cluster_singlebattery')?.value == 0" class="col-12 p-0">

          <div class="col-12 p-0">
            <label class="form-check-label mt-3 mr-2" for="cluster_parallel">
              Parallel Cluster</label>
            <div class="form-check form-check-inline">
              <input class="form-check-input mt-1" type="radio" id="cluster_parallel_yes" [value]="1"
                formControlName="cluster_parallel">
              <label class="form-check-label" for="cluster_parallel_yes">Yes</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input mt-1" type="radio" [value]="0" id="cluster_parallel_no"
                formControlName="cluster_parallel">
              <label class="form-check-label" for="cluster_parallel_no">No</label>
            </div>
          </div>

          <div class="col-12 col-md-6 mt-3 p-0">
            <label for="cluster_number" style="font-weight: bold; font-size: medium;">
              How many clusters?
            </label>
            <select class="form-select" formControlName="cluster_number" id="cluster_number">
              <option [ngValue]="null">Select a value</option>
              <option *ngFor="let cluster of numCluster" [ngValue]="cluster.num"> {{cluster.num}}
              </option>
            </select>
          </div>
          <div class="col-12 col-md-6 mt-3 p-0">
            <label for="cluster_numberdevices" style="font-weight: bold; font-size: medium;">
              How many devices for each cluster?
            </label>
            <select class="form-select" formControlName="cluster_numberdevices" id="cluster_numberdevices">
              <option [ngValue]="null">Select a value</option>
              <option *ngFor="let device of numDevicesCluster" [ngValue]="device.num"> {{device.num}}
              </option>
            </select>
          </div>
        </div>
        <!-- <div class="col-12"
         *ngIf="(stepClusterForm.get('cluster_number')?.value > 0 && stepClusterForm.get('cluster_numberdevices')?.value? > 0) ||
        stepClusterForm.get('cluster_singlebattery')?.value == 1"> -->
        <div class="col-12" *ngIf="(stepClusterForm.get('cluster_number')?.value != null && stepClusterForm.get('cluster_numberdevices')?.value != null) ||
        stepClusterForm.get('cluster_singlebattery')?.value == 1">
        <div class="container-fluid mt-4">
          <div class="row">
            <div *ngFor="let cluster of clusterFieldAsFormArray.controls ;let i = index;" formArrayName='clusters_list'
              class="mb-4 col-12 col-sm-6 col-lg-4">
              <div [formGroupName]="i">
                <mat-card>
                  <mat-card-header>
                    <mat-card-title style="font-weight: bold; font-size: medium;">
                      Cluster {{i + 1}}</mat-card-title>
                  </mat-card-header>
                  <mat-card-content>
                    <div *ngFor="let bat of cluster.get('batteries').controls;let j = index" formArrayName="batteries">
                      <div [formGroupName]="j" class="row">
                        <div class="col-12"
                          style="margin-top: 0px; margin-bottom: 0px;padding-top: 0px; padding-bottom: 0px;"
                          [ngClass]="{'mt-2': j == 0}">
                          <span class="">{{bat.get('masterorslave').value}}</span>
                        </div>
                        <div class="col-8 ">
                          <label style="font-weight: bold; font-size: medium;" for="sn-{{i}}-{{j}}">Serial
                            Number</label>
                          <input id="sn-{{i}}-{{j}}" class="form-control" type="text" formControlName="serialnumber">
                        </div>
                      </div>
                    </div>

                  </mat-card-content>

                  <!-- <div class="field my-4 col-12">
                  <p-multiSelect [options]="listaInverter" formControlName="inverter" optionLabel="sn"
                    placeholder="Select inverter"></p-multiSelect>
                </div> -->
                </mat-card>
              </div>
            </div>
          </div>
          </div>
        </div>

        <!--
           <mat-card class="col-12 col-sm-6 col-md-4 col-lg-3">
            <mat-card-header style="border-bottom: 2px solid lightgray;">
              <mat-card-title style="font-weight: bold; font-size: medium;">
                Cluster 1</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="row justify-content-center" formGroupName="battery">
                <div class="col-12 mt-2 p-0">
                  <label style="font-weight: bold; font-size: medium;">Serial Number</label>
                  <input class="form-control" type="text" formControlName="serialNumber">
                </div>
                <div class="col-12 mt-2 p-0 form-check form-switch">
                  <input class="form-check-input" type="checkbox" role="switch" id="askSupport"
                    formControlName="askSupport">
                  <label class="form-check-label" for="askSupport">Ask Support for
                    this cluster</label>
                </div>
              </div>

              <div class="col-12 col-md-6 mb-3">
                <label for="relatedInverter" style="font-weight: bold;">Related Inverter</label>
                <select class="form-select" aria-label="select example" formControlName="relatedInverter">
                  <option [ngValue]="null" disabled selected>Select an Option</option>
                  <option value="inverter"> Inverter 1 </option>
                  <option value="batteryInverter"> Inverter 2 </option>
                </select>
              </div>
            </mat-card-content>
          </mat-card> -->

      </mat-card-content>
    </mat-card>
  </div>
</form>
